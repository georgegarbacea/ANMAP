<!doctype html>
<html lang="ro">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<title>ANMAP_login</title>
<style>
  :root{--bg:#f4f7fb;--card:#fff;--accent:#165fb1;--muted:#6e7480;--border:#e6e9ef}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#111}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:20px}
  .card{width:100%;max-width:820px;background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 28px rgba(13,30,70,0.07)}
  h1{margin:0 0 4px;font-size:22px;font-weight:700;color:#0f3d7a}
  h2.subtitle{margin:0 0 12px;font-size:15px;font-weight:500;color:var(--muted)}
  label{font-size:13px;color:#333}
  input, select, textarea{width:100%;padding:12px;margin-top:6px;border-radius:9px;border:1px solid var(--border);font-size:15px;background:#fff}
  .section{margin-top:16px;padding-top:8px;border-top:1px dashed #e3e8f3}
  button{padding:12px 16px;border-radius:9px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer}
  .tg-link{display:inline-block;text-align:center;padding:12px 16px;border-radius:9px;border:1px solid #dfe6f3;background:transparent;color:#0f3d7a;text-decoration:none;font-weight:700}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ANMAP_login</h1>
      <h2 class="subtitle">AgenÈ›ia NaÈ›ionalÄƒ de Mediu È™i Arii Protejate</h2>

      <!-- LOGIN -->
      <div id="loginBox">
        <div>
          <label for="user">Utilizator</label>
          <input id="user" placeholder="IntroduceÈ›i utilizatorul" autocomplete="off" readonly onfocus="this.removeAttribute('readonly');"/>
        </div>
        <div>
          <label for="pass">ParolÄƒ</label>
          <input id="pass" type="password" placeholder="IntroduceÈ›i parola" autocomplete="off" readonly onfocus="this.removeAttribute('readonly');"/>
        </div>
        <div class="section">
          <button id="btnLogin">Conectare</button>
          <small class="warn" id="warn" style="color:#a00;display:none"></small>
        </div>
      </div>

      <!-- SECURE AREA -->
      <div id="secureArea" style="display:none">
        <p>Formular intern â€” Proces-verbal de amplasament</p>
        <a class="tg-link" id="tgWeb" href="#">ANMAP_web</a><br>
        <button id="btnLogout" style="margin-top:10px">Deconectare</button>
      </div>
    </div>
  </div>

<script>
const USERS={
  "george_g":"ab25424b76ddc669226641b8aa053cfe537df61d33f935fba3687c4924b9c84a",
  "anca_g":"ab25424b76ddc669226641b8aa053cfe537df61d33f935fba3687c4924b9c84a"
};

const user=document.getElementById('user');
const pass=document.getElementById('pass');
const btn=document.getElementById('btnLogin');
const logout=document.getElementById('btnLogout');
const secure=document.getElementById('secureArea');
const login=document.getElementById('loginBox');
const warn=document.getElementById('warn');
const tg=document.getElementById('tgWeb');

async function sha256hex(msg){
  const buf=await crypto.subtle.digest('SHA-256',new TextEncoder().encode(msg));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

function toLogin(){
  secure.style.display='none';
  login.style.display='block';
  user.value='';pass.value='';
}

function forceLoginReload(){
  // ForÈ›Äƒm Ã®ntotdeauna revenirea la login, chiar È™i cÃ¢nd browserul pÄƒstreazÄƒ tab-ul Telegram
  window.location.replace(window.location.origin+window.location.pathname+'?r='+Date.now());
}

btn.addEventListener('click',async()=>{
  warn.style.display='none';
  const u=user.value.trim(), p=pass.value;
  if(!u||!p){warn.textContent='CompleteazÄƒ utilizator È™i parolÄƒ.';warn.style.display='block';return;}
  if(!(u in USERS)){warn.textContent='Utilizator sau parolÄƒ incorecte.';warn.style.display='block';return;}
  const h=await sha256hex(p);
  if(h!==USERS[u]){warn.textContent='Utilizator sau parolÄƒ incorecte.';warn.style.display='block';return;}
  login.style.display='none'; secure.style.display='block';
});

logout.addEventListener('click',forceLoginReload);

// ðŸ”¹ deschide Telegram Ã®n tab NOU È™i reseteazÄƒ sesiunea imediat
tg.addEventListener('click', e=>{
  e.preventDefault();
  window.open('https://web.telegram.org/', '_blank');
  setTimeout(forceLoginReload,100);
});

// ðŸ”¹ cÃ¢nd ieÈ™i din aplicaÈ›ie / browser / tab sau revii, revine la login
['pagehide','visibilitychange','blur','focus','pageshow','beforeunload'].forEach(evt=>{
  window.addEventListener(evt, ()=>{
    if(evt==='visibilitychange' && document.visibilityState==='hidden'){ forceLoginReload(); }
    else if(evt!=='visibilitychange'){ forceLoginReload(); }
  });
});

// reset UI la Ã®ncÄƒrcare
document.addEventListener('DOMContentLoaded', toLogin);
</script>
</body>
</html>
